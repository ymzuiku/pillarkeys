{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports/./node_modules/mocha-js-delegate/index.js","webpack://exports/./node_modules/sketch-nibui/index.js","webpack://exports/./src/command-export-options.js","webpack://exports/./src/lib/delegate.js","webpack://exports/./src/lib/plugin-user-prefs.js","webpack://exports/./src/prefs.js"],"names":["context","nib","window","NSWindow","alloc","initWithContentRect_styleMask_backing_defer","NSMakeRect","rootView","frame","size","width","height","NSTitledWindowMask","NSClosableWindowMask","NSWindowStyleMaskFullSizeContentView","NSBackingStoreBuffered","setDelegate","NSApp","stopModal","getClassInstance","setContentView","setAutorecalculatesKeyViewLoop","views","saveButton","setKeyEquivalent","icon","setImage","NSImage","initWithContentsOfFile","plugin","urlForResourceNamed","path","controllers","PopUpButtonFieldController","view","exportScaleField","prefKey","options","EXPORT_SCALES","CheckboxFieldController","showHotspotsCheckbox","forEach","c","load","modalDelegate","orderOut","beginSheet_modalForWindow_modalDelegate_didEndSelector_contextInfo_","document","documentWindow","NSSelectorFromString","returnValue","Delegate","setDefaultsButton","setAsDefault","cancelButton","endSheet","save","runModalForWindow","refresh_","removeAllItems","currentValue","defaultValue","value","label","def","addItemWithTitle","indexOfCurrent","findIndex","selectItemAtIndex","selectedIndex","indexOfSelectedItem","updateDict","prefs","setState","NSControlStateValueOn","NSControlStateValueOff","state","setTargetAndAction","fn","delegate","setTarget","setAction","set","key","userDefaults","getUserDefaults","setObject_forKey_","JSON","stringify","synchronize","get","storedValue","stringForKey_","val","parse","undefined","e","pluginId","String","identifier","NSUserDefaults","initWithSuiteName","PREFS_KEY","DEFAULTS","exportScale","showHotspots","resolveDocumentPrefs","Object","assign","getUserOrDefaultPrefs","getDocumentPrefs","getDefaultPrefs","getUserPrefs","updateUserPrefs","k","setUserPrefs","pluginUserPrefs","v","command","valueForKey_onDocument_","documentData","jsonData","NSJSONSerialization","dataWithJSONObject_options_error_","jsonString","NSString","initWithData_encoding_","NSUTF8StringEncoding","updateDocumentPrefs","setDocumentPrefs","setValue_forKey_onDocument_"],"mappings":";;;;;;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;ACnEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,uEAAuE,wDAAwD,EAAE;;AAEjI;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC9DA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,qBAAqB,6BAA6B;AAClD;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,gDAAgD,QAAQ;AACxD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB,WAAW;AAC9B;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;ACzFA;;;;;;;;;;;;;;;AAgBA;AACA;AAEA;AAEA;AAGA,+DAAe,UAASA,OAAT,EA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","file":"command-export-options.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/command-export-options.js\");\n","/* globals NSUUID MOClassDescription NSObject NSSelectorFromString NSClassFromString */\n\nmodule.exports = function (selectorHandlerDict, superclass) {\n  var uniqueClassName = 'MochaJSDelegate_DynamicClass_' + NSUUID.UUID().UUIDString()\n\n  var delegateClassDesc = MOClassDescription.allocateDescriptionForClassWithName_superclass_(uniqueClassName, superclass || NSObject)\n\n  delegateClassDesc.registerClass()\n\n  // Storage Handlers\n  var handlers = {}\n\n  // Define interface\n  this.setHandlerForSelector = function (selectorString, func) {\n    var handlerHasBeenSet = (selectorString in handlers)\n    var selector = NSSelectorFromString(selectorString)\n\n    handlers[selectorString] = func\n\n    /*\n      For some reason, Mocha acts weird about arguments: https://github.com/logancollins/Mocha/issues/28\n      We have to basically create a dynamic handler with a likewise dynamic number of predefined arguments.\n    */\n    if (!handlerHasBeenSet) {\n      var args = []\n      var regex = /:/g\n      while (regex.exec(selectorString)) {\n        args.push('arg' + args.length)\n      }\n\n      var dynamicFunction = eval('(function (' + args.join(', ') + ') { return handlers[selectorString].apply(this, arguments); })')\n\n      delegateClassDesc.addInstanceMethodWithSelector_function_(selector, dynamicFunction)\n    }\n  }\n\n  this.removeHandlerForSelector = function (selectorString) {\n    delete handlers[selectorString]\n  }\n\n  this.getHandlerForSelector = function (selectorString) {\n    return handlers[selectorString]\n  }\n\n  this.getAllHandlers = function () {\n    return handlers\n  }\n\n  this.getClass = function () {\n    return NSClassFromString(uniqueClassName)\n  }\n\n  this.getClassInstance = function () {\n    return NSClassFromString(uniqueClassName).new()\n  }\n\n  // Convenience\n  if (typeof selectorHandlerDict === 'object') {\n    for (var selectorString in selectorHandlerDict) {\n      this.setHandlerForSelector(selectorString, selectorHandlerDict[selectorString])\n    }\n  }\n}\n","/*\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport function load(context, nibName) {\n  return new NibUI(context, nibName);\n}\n\nclass NibUI {\n  constructor(context, nibName) {\n    let bundle = NSBundle.bundleWithURL(context.plugin.url());\n\n    // register a class that doesn't exist yet. note that we can't reuse the same\n    // definition lest Sketch will throw an MOJavaScriptException when binding the UI,\n    // probably due to JavaScript context / plugin lifecycle incompatibility\n\n    let tempClassName;\n    while (true) {\n      tempClassName = 'NibOwner' + randomId();\n      if (NSClassFromString(tempClassName) == null) {\n        break;\n      }\n    }\n\n    this.cls_ = MOClassDescription.allocateDescriptionForClassWithName_superclass_(\n        tempClassName, NSClassFromString('NSObject'));\n    this.cls_.registerClass();\n    this.nibOwner_ = NSClassFromString(tempClassName).alloc().init();\n\n    let tloPointer = MOPointer.alloc().initWithValue(null);\n\n    if (bundle.loadNibNamed_owner_topLevelObjects_(nibName, this.nibOwner_, tloPointer)) {\n      let topLevelObjects = tloPointer.value();\n      for (var i = 0; i < topLevelObjects.count(); i++) {\n        let obj = topLevelObjects.objectAtIndex(i);\n        if (obj.className().endsWith('View')) {\n          this.rootView = obj;\n          break;\n        }\n      }\n    } else {\n      throw new Error(`Error loading nib file ${nibName}.nib`);\n    }\n\n    // populate view IDs\n    this.views = {};\n    walkViewTree(this.rootView, view => {\n      let id = String(view.identifier());\n      if (id && !id.startsWith('_')) {\n        this.views[id] = view;\n      }\n    });\n  }\n}\n\n/**\n * Depth-first traversal for NSViews.\n */\nfunction walkViewTree(rootView, fn) {\n  let visit_ = view => {\n    fn(view);\n\n    let nsArray = view.subviews();\n    let count = nsArray.count();\n    for (let i = 0; i < count; i++) {\n      visit_(nsArray.objectAtIndex(i));\n    }\n  };\n\n  visit_(rootView);\n}\n\n/**\n * Generates a random unsigned integer.\n */\nfunction randomId() {\n  return (1000000 * Math.random()).toFixed(0);\n}\n","/*\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport MochaJSDelegate from 'mocha-js-delegate';\nimport * as NibUI from 'sketch-nibui';\n\nimport * as Delegate from './lib/delegate';\n\nimport * as prefs from './prefs';\n\n\nexport default function(context) {\n  let nib = NibUI.load(context, 'Prefs');\n  let window = NSWindow.alloc().initWithContentRect_styleMask_backing_defer(\n      NSMakeRect(0, 0, nib.rootView.frame().size.width, nib.rootView.frame().size.height),\n      NSTitledWindowMask | NSClosableWindowMask | NSWindowStyleMaskFullSizeContentView,\n      NSBackingStoreBuffered,\n      false);\n  window.setDelegate(new MochaJSDelegate({\n    'windowWillClose:': () => NSApp.stopModal()\n  }).getClassInstance());\n  window.setContentView(nib.rootView);\n  window.setAutorecalculatesKeyViewLoop(true);\n\n  nib.views.saveButton.setKeyEquivalent('\\r');\n  nib.views.icon.setImage(\n      NSImage.alloc().initWithContentsOfFile(\n          context.plugin.urlForResourceNamed('icon.png').path()));\n\n  let controllers = [\n    new PopUpButtonFieldController(context, {\n      view: nib.views.exportScaleField,\n      prefKey: 'exportScale',\n      options: prefs.EXPORT_SCALES,\n    }),\n    // new PopUpButtonFieldController(context, {\n    //   view: nib.views.layoutField,\n    //   prefKey: 'layout',\n    //   options: prefs.LAYOUTS,\n    // }),\n    new CheckboxFieldController(context, {\n      view: nib.views.showHotspotsCheckbox,\n      prefKey: 'showHotspots',\n    }),\n  ];\n\n  controllers.forEach(c => c.load());\n\n  let modalDelegate = new MochaJSDelegate({\n    'close:': () => {\n      NSApp.stopModal();\n      window.orderOut(null);\n    }\n  }).getClassInstance();\n\n  NSApp.beginSheet_modalForWindow_modalDelegate_didEndSelector_contextInfo_(\n      window,\n      context.document.documentWindow(),\n      modalDelegate,\n      NSSelectorFromString('close:'),\n      null);\n\n  let returnValue = null;\n\n  Delegate.setTargetAndAction(nib.views.setDefaultsButton, () => {\n    controllers.forEach(c => c.setAsDefault());\n  });\n\n  Delegate.setTargetAndAction(nib.views.cancelButton, () => NSApp.endSheet(window));\n  Delegate.setTargetAndAction(nib.views.saveButton, () => {\n    controllers.forEach(c => c.save());\n\n    NSApp.endSheet(window);\n  });\n\n  NSApp.runModalForWindow(window); // blocks\n}\n\n\nclass PopUpButtonFieldController {\n  constructor(context, {view, prefKey, options}) {\n    this.view = view;\n    this.context = context;\n    this.prefKey = prefKey;\n    this.options = options;\n  }\n\n  load() {\n    this.refresh_();\n  }\n\n  refresh_() {\n    this.view.removeAllItems();\n    let currentValue = prefs.resolveDocumentPrefs(context, context.document)[this.prefKey];\n    let defaultValue = prefs.getUserOrDefaultPrefs(context)[this.prefKey];\n    this.options.forEach(({value, label}) => {\n      let def = (value == defaultValue) ? ' (default)' : '';\n      this.view.addItemWithTitle(`${label}${def}`);\n    });\n    let indexOfCurrent = this.options.findIndex(({value}) => value == currentValue);\n    if (indexOfCurrent >= 0) {\n      this.view.selectItemAtIndex(indexOfCurrent);\n    }\n  }\n\n  save() {\n    let selectedIndex = this.view.indexOfSelectedItem();\n    let value = this.options[selectedIndex].value;\n    let defaultValue = prefs.getUserOrDefaultPrefs(context)[this.prefKey];\n    if (value == defaultValue) {\n      value = null;\n    }\n\n    let updateDict = {};\n    updateDict[this.prefKey] = value;\n    prefs.updateDocumentPrefs(context, context.document, updateDict);\n  }\n\n  setAsDefault() {\n    let selectedIndex = this.view.indexOfSelectedItem();\n    let value = this.options[selectedIndex].value;\n    let updateDict = {};\n    updateDict[this.prefKey] = value;\n    prefs.updateUserPrefs(context, updateDict);\n    this.refresh_();\n    this.view.selectItemAtIndex(selectedIndex);\n  }\n}\n\n\nclass CheckboxFieldController {\n  constructor(context, {view, prefKey}) {\n    this.view = view;\n    this.context = context;\n    this.prefKey = prefKey;\n  }\n\n  load() {\n    let currentValue = !!prefs.resolveDocumentPrefs(context, context.document)[this.prefKey];\n    this.view.setState(currentValue ? NSControlStateValueOn : NSControlStateValueOff);\n  }\n\n  save() {\n    let value = (this.view.state() == NSControlStateValueOn);\n    let updateDict = {};\n    updateDict[this.prefKey] = value;\n    prefs.updateDocumentPrefs(context, context.document, updateDict);\n  }\n\n  setAsDefault() {\n    let value = (this.view.state() == NSControlStateValueOn);\n    let updateDict = {};\n    updateDict[this.prefKey] = value;\n    prefs.updateUserPrefs(context, updateDict);\n  }\n}\n","/*\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport MochaJSDelegate from 'mocha-js-delegate';\n\nexport function setTargetAndAction(view, fn) {\n  let delegate = new MochaJSDelegate({'action:': fn}).getClassInstance();\n  view.setTarget(delegate);\n  view.setAction(NSSelectorFromString('action:'));\n}\n","/*\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n \n/**\n * Sets a preference for the plugin with the given key and value.\n */\nexport function set(context, key, value) {\n  let userDefaults = getUserDefaults(context);\n  userDefaults.setObject_forKey_(JSON.stringify(value), key);\n  userDefaults.synchronize(); // save\n};\n\n\n/**\n * Gets the value for the given preference.\n */\nexport function get(context, key, defaultValue) {\n  let userDefaults = getUserDefaults(context);\n  let storedValue = userDefaults.stringForKey_(key);\n  try {\n    let val = JSON.parse(storedValue);\n    if (val === null || val === undefined) {\n      return defaultValue;\n    }\n    return val;\n  } catch (e) {\n    return defaultValue;\n  }\n}\n\n\nfunction getUserDefaults(context) {\n  let pluginId = String(context.plugin.identifier());\n  return NSUserDefaults.alloc().initWithSuiteName(pluginId);\n}\n","/*\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as pluginUserPrefs from './lib/plugin-user-prefs';\n\n\nconst PREFS_KEY = 'export_options';\n\n\nexport const EXPORT_SCALES = [\n  { value: 1, label: '1x' },\n  { value: 2, label: '2x' },\n];\n\n\n// export const LAYOUTS = [\n//   { value: 'simple', label: 'Simple' },\n//   { value: 'centered', label: 'Centered' },\n// ];\n\n\nconst DEFAULTS = {\n  exportScale: 1,\n  // layout: 'simple',\n  showHotspots: true,\n};\n\n\nexport function resolveDocumentPrefs(context, document) {\n  return Object.assign(\n      getUserOrDefaultPrefs(context),\n      getDocumentPrefs(context, document));\n}\n\n\nexport function getDefaultPrefs() {\n  return Object.assign({}, DEFAULTS);\n}\n\n\nexport function getUserOrDefaultPrefs(context) {\n  return Object.assign(\n      getDefaultPrefs(),\n      getUserPrefs(context));\n}\n\n\nexport function getUserPrefs(context) {\n  return pluginUserPrefs.get(context, PREFS_KEY, {});\n}\n\n\nexport function updateUserPrefs(context, prefs) {\n  prefs = Object.assign(\n      getUserPrefs(context),\n      prefs);\n  for (var k in prefs) {\n    if (prefs[k] === null) {\n      delete prefs[k];\n    }\n  }\n  setUserPrefs(context, prefs);\n}\n\n\nexport function setUserPrefs(context, prefs) {\n  pluginUserPrefs.set(context, PREFS_KEY, prefs);\n}\n\n\nexport function getDocumentPrefs(context, document) {\n  let v = context.command.valueForKey_onDocument_(PREFS_KEY, document.documentData()) || {};\n  // convert v to a more pure JS object by serializing to JSON in Cocoa\n  let jsonData = NSJSONSerialization.dataWithJSONObject_options_error_(v, 0, null);\n  let jsonString = NSString.alloc().initWithData_encoding_(jsonData, NSUTF8StringEncoding);\n  return JSON.parse(jsonString) || {};\n}\n\n\nexport function updateDocumentPrefs(context, document, prefs) {\n  prefs = Object.assign(\n      getDocumentPrefs(context, document),\n      prefs);\n  for (var k in prefs) {\n    if (prefs[k] === null) {\n      delete prefs[k];\n    }\n  }\n  setDocumentPrefs(context, document, prefs);\n}\n\n\nexport function setDocumentPrefs(context, document, prefs) {\n  context.command.setValue_forKey_onDocument_(prefs, PREFS_KEY, document.documentData());\n}\n"],"sourceRoot":""}